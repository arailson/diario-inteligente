name: Weekly Report - DiÃ¡rio Inteligente

# Executa todo sÃ¡bado Ã s 9h (horÃ¡rio de BrasÃ­lia)
on:
  schedule:
    # Cron: minuto hora dia mÃªs dia-da-semana
    # 0 12 * * 6 = Todo sÃ¡bado Ã s 12h UTC (9h BrasÃ­lia)
    - cron: '0 12 * * 6'
  
  # Permite execuÃ§Ã£o manual para testes
  workflow_dispatch:
    inputs:
      test_email:
        description: 'Email para teste (opcional)'
        required: false
        type: string

jobs:
  send-weekly-report:
    runs-on: ubuntu-latest
    
    steps:
    - name: ðŸ“¥ Checkout do cÃ³digo
      uses: actions/checkout@v4
    
    - name: ðŸ Configurar Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: ðŸ“¦ Instalar dependÃªncias
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: ðŸ”§ Configurar variÃ¡veis de ambiente
      run: |
        echo "DATABASE_PATH=data/reviews.db" >> $GITHUB_ENV
        echo "EMAIL_USER=${{ secrets.EMAIL_USER }}" >> $GITHUB_ENV
        echo "EMAIL_PASSWORD=${{ secrets.EMAIL_PASSWORD }}" >> $GITHUB_ENV
        echo "EMAIL_SMTP_SERVER=smtp.gmail.com" >> $GITHUB_ENV
        echo "EMAIL_SMTP_PORT=587" >> $GITHUB_ENV
        echo "WEEKLY_REPORT_EMAIL=${{ secrets.WEEKLY_REPORT_EMAIL }}" >> $GITHUB_ENV
    
    - name: ðŸ“Š Executar relatÃ³rio semanal
      run: |
        python weekly_report.py
      env:
        WEEKLY_REPORT_EMAIL: ${{ github.event.inputs.test_email || secrets.WEEKLY_REPORT_EMAIL }}
    
    - name: âœ… RelatÃ³rio enviado
      run: |
        echo "ðŸŽ‰ RelatÃ³rio semanal enviado com sucesso!"
        echo "ðŸ“… Data: $(date)"
        echo "ðŸ“§ Email: ${{ secrets.WEEKLY_REPORT_EMAIL }}"
